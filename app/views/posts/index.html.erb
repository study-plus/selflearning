<h1>ToDoリスト</h1>
<%= button_to("ログアウト", destroy_user_session_path, method: :delete) %>
<% if user_signed_in? %>
    <%= link_to("マイページへ", user_path(current_user.id))%>
<% end %>

<h3>やること一覧</h3>
<h3>投稿の検索</h3>
<%= form_tag({controller:"posts",action:"index"}, method: :get) do %>
    <%= text_field_tag :search %>
        <%= submit_tag "検索" %>
<% end %>

<%= link_to("新規投稿", new_post_path) %>
<div class="posts-container">
    <% @posts.each do |p| %>
        <%= p.user.email %>
        <a href="/users/<%= p.user.id %>"><%= p.user.name %></a>
        <div class="post">
            <div class="main-box">
                <div class="left-container">
                        <%= p.subject_name %> <%= p.content %>
                    <% if user_signed_in? %>
                        <% if current_user.id == p.user_id %>
                            <% if current_user.already_checked?(p) %>
                                <i class="fas fa-check-square"></i>
                            <% else %>
                                <%= link_to post_checks_path(id: p.id, post_id: p.id), method: :post do %>
                                    <i class="far fa-check-square"></i>
                                <% end %>
                            <% end %>
                        <% end %>
                        <% if current_user.already_liked?(p) %>
                            <%= link_to post_like_path(id: p.id, post_id: p.id), method: :delete do %>
                                <i class="fas fa-heart"></i><%= p.likes.count %>
                            <% end %>
                        <% else %>
                            <%= link_to post_likes_path(id: p.id, post_id: p.id), method: :post do %>
                                <i class="far fa-heart"></i><%= p.likes.count %>
                            <% end %>
                        <% end %>
                    <% else %>
                        <i class="far fa-heart"></i><%= p.likes.count %>
                    <% end %>
                </div>
                <div class="right-container">
                    <%= link_to("詳細", post_path(p.id)) %>
                    <% if user_signed_in? && current_user.id == p.user_id %>
                        <%= link_to("編集", edit_post_path(p.id)) %>
                        <%= link_to("削除", post_path(p.id), method: :delete) %>
                    <% end %>
                </div>
            </div>
                <p class="time"><%= p.created_at %></p>
        </div>
    <% end %>
</div>

<div class="main-container">
    <% if user_signed_in? %>
        <div class="todo-container">
            <h3>やることリスト</h3>
            <h3>投稿の検索</h3>
            <%= form_tag({controller:"posts",action:"index"}, method: :get) do %>
                <%= text_field_tag :search %>
                <%= submit_tag "検索" %>
            <% end %>
            <h3><%= link_to("新規投稿", new_post_path) %></h3>
            <% @myposts.each do |mp| %>
                <div class="left-container">
                    <% if current_user.already_checked?(mp) %>
                        <i class="fas fa-check-square"></i>
                    <% else %>
                        <%= link_to post_checks_path(id: mp.id, post_id: mp.id), method: :post do %>
                            <i class="far fa-check-square"></i>
                        <% end %>
                    <% end %>
                    <%= mp.subject_name %> <%= mp.content %>
                </div>
                <div class="right-container">
                    <%= link_to("編集する", edit_post_path(mp.id)) %>
                    <%= link_to("削除する", post_path(mp.id), method: :delete) %>
                </div>
            <% end %>
        </div>
        <div class="timeline-container">
            <h3>タイムライン</h3>
            <h3>検索</h3>
            <%= form_tag({controller:"posts",action:"index"}, method: :get) do %>
                <%= text_field_tag :search %>
                <%= submit_tag "検索" %>
            <% end %>
            <% @posts.each do |p| %>
                <% if current_user.already_checked?(p) %>
                    <a href="/users/<%= p.user.id %>"><%= p.user.name %></a>
                    <div class="post">
                        <div class="main-box">
                            <div class="left-container">
                                <%= p.subject_name %> <%= p.content %>
                                <% if user_signed_in? %>
                                    <% if current_user.already_liked?(p) %>
                                        <%= link_to post_like_path(id: p.id, post_id: p.id), method: :delete do %>
                                            <i class="fas fa-heart"></i><%= p.likes.count %>
                                        <% end %>
                                    <% else %>
                                        <%= link_to post_likes_path(id: p.id, post_id: p.id), method: :post do %>
                                            <i class="far fa-heart"></i><%= p.likes.count %>
                                        <% end %>
                                    <% end %>
                                <% else %>
                                    <i class="far fa-heart"></i><%= p.likes.count %>
                                <% end %>
                            </div>
                            <div class="right-container">
                                <%= link_to("詳細", post_path(p.id)) %>
                            </div>
                        </div>
                        <p class="time"><%= p.created_at %></p>
                    </div>
                <% end %>
            <% end %>
        </div>
    <% end %>
</div>